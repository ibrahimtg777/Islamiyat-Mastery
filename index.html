<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CAIE Notes â€” Forest Rain Edition</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Basic page setup */
    html,body { height: 100%; margin: 0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#071422; color: #e6eef8; }
    /* Background layers */
    #bg {
      position: fixed; inset: 0;
      background-image: url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1950&q=80');
      background-size: cover; background-position: center;
      filter: saturate(0.9) contrast(0.85) brightness(0.6);
      z-index: -4;
    }
    #overlay {
      position: fixed; inset: 0;
      background: linear-gradient(180deg, rgba(3,6,12,0.28), rgba(2,6,23,0.68));
      z-index: -3;
    }
    /* rain canvas */
    #rainCanvas {
      position: fixed; inset: 0; z-index: -2; pointer-events: none; mix-blend-mode: screen; opacity: .9;
    }
    /* glass card look */
    .glass {
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.04);
      backdrop-filter: blur(6px) saturate(1.05);
      -webkit-backdrop-filter: blur(6px) saturate(1.05);
    }
    .card-hover { transition: transform .22s ease, box-shadow .22s ease; }
    .card-hover:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(2,6,23,0.6); }
    .note-content { white-space: pre-wrap; color: #e6eef8; line-height: 1.6; }
    /* responsive grid */
    .grid-cols-responsive { grid-template-columns: repeat(1, minmax(0,1fr)); }
    @media(min-width:640px){ .grid-cols-responsive { grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media(min-width:1024px){ .grid-cols-responsive { grid-template-columns: repeat(3, minmax(0,1fr)); } }
    /* small tweaks */
    .muted-btn { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.04); color: #dbeafe; }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Background layers -->
  <div id="bg" aria-hidden="true"></div>
  <div id="overlay" aria-hidden="true"></div>
  <canvas id="rainCanvas" aria-hidden="true"></canvas>

  <!-- Topbar -->
  <header class="relative z-10 py-5">
    <div class="max-w-7xl mx-auto px-4 flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-extrabold tracking-tight">ðŸŒ² CAIE Notes â€” Forest Rain Edition</h1>
        <p class="text-slate-300 mt-1 max-w-xl">Original, syllabus-aligned study notes for major CAIE subjects. Click a subject to preview, then <strong>Unlock â€” $6.99</strong> (simulated) to view the full notes in your browser.</p>
      </div>
      <div class="flex items-center gap-3">
        <button id="unlockAllBtn" class="px-4 py-2 rounded-md muted-btn hover:bg-white/5 transition">Unlock All</button>
        <button id="downloadAllBtn" class="px-4 py-2 rounded-md muted-btn hover:bg-white/5 transition">Download All</button>
        <div class="flex items-center gap-2 ml-2">
          <button id="audioToggle" class="px-3 py-2 rounded-md bg-slate-800/60 border border-white/6 text-sky-200">ðŸ”ˆ Ambience</button>
          <span id="soundStatus" class="text-xs text-slate-300">Muted</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="relative z-10 flex-1">
    <div class="max-w-7xl mx-auto px-4 pb-12">
      <section class="grid gap-6 grid-cols-responsive">
        <!-- Info Card -->
        <div class="glass rounded-2xl p-6 card-hover">
          <h2 class="text-xl font-semibold">How to use</h2>
          <p class="text-slate-300 mt-2">This is a single HTML file. Unlocking is simulated and saved to your browser's storage only. Use <strong>Download</strong> to save notes to your computer. Press <strong>Shift + L</strong> to lock (clear unlocked subjects).</p>
          <div class="mt-4 flex gap-3">
            <button id="lockBtn" class="px-4 py-2 rounded-md bg-rose-600 hover:brightness-105">Lock All</button>
            <button id="aboutBtn" class="px-4 py-2 rounded-md muted-btn">About Notes</button>
          </div>
        </div>

        <!-- Subjects area (cards) -->
        <div class="glass rounded-2xl p-6 card-hover col-span-1 lg:col-span-2">
          <h3 class="text-lg font-semibold mb-4">Subjects</h3>
          <div id="subjectsGrid" class="grid gap-4 grid-cols-responsive">
            <!-- JS populates subject cards -->
          </div>
        </div>
      </section>

      <div class="text-center text-slate-300 text-sm mt-8">Tip: Hit <strong>Escape</strong> to close a note. Â© <span id="year"></span></div>
    </div>
  </main>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 hidden z-30 items-center justify-center">
    <div class="absolute inset-0 bg-black/60" id="modalBackdrop"></div>
    <div class="relative max-w-4xl w-full mx-4">
      <div class="bg-gradient-to-r from-slate-900/85 to-slate-800/85 rounded-2xl p-6 glass shadow-2xl">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h2 id="modalTitle" class="text-2xl font-bold text-sky-100"></h2>
            <p id="modalSubtitle" class="text-slate-300 text-sm mt-1"></p>
          </div>
          <div class="flex gap-2">
            <button id="modalDownload" class="px-3 py-2 border rounded text-sky-100">Download</button>
            <button id="modalPrint" class="px-3 py-2 border rounded text-sky-100">Print</button>
            <button id="modalClose" class="px-3 py-2 bg-rose-600 rounded text-white">Close</button>
          </div>
        </div>
        <div class="mt-4 max-h-[65vh] overflow-auto note-content pr-4" id="modalContent"></div>
      </div>
    </div>
  </div>

  <script>
  /*******************************
   *  Rain animation (canvas)
   *******************************/
  (function(){
    const canvas = document.getElementById('rainCanvas');
    const ctx = canvas.getContext('2d');
    let W = canvas.width = innerWidth;
    let H = canvas.height = innerHeight;
    let drops = [];
    const baseCount = 1200;

    function rand(min, max) { return Math.random()*(max-min)+min; }
    function adjust() {
      W = canvas.width = innerWidth;
      H = canvas.height = innerHeight;
      drops = [];
      const count = Math.max(150, Math.floor(baseCount * (W*H)/(1920*1080)));
      for (let i=0;i<count;i++){
        drops.push({
          x: Math.random()*W,
          y: Math.random()*H,
          len: rand(8, 22),
          speed: rand(400, 1100),
          thickness: rand(0.8, 1.6),
          sway: rand(-0.7, 0.7),
          opacity: rand(0.12, 0.28)
        });
      }
    }
    let last = performance.now();
    function animate(now){
      const dt = (now-last)/1000; last = now;
      ctx.clearRect(0,0,W,H);

      // draw subtle mist overlay
      const g = ctx.createLinearGradient(0,0,0,H);
      g.addColorStop(0, 'rgba(0,0,0,0)');
      g.addColorStop(1, 'rgba(0,0,0,0.12)');
      ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

      ctx.lineCap = 'round';
      for (let d of drops) {
        d.y += d.speed * dt;
        d.x += Math.sin((d.y + now*0.0006)) * d.sway * 3;
        if (d.y > H + 20) { d.y = -20; d.x = Math.random()*W; }
        ctx.beginPath();
        ctx.strokeStyle = `rgba(200,230,255,${d.opacity})`;
        ctx.lineWidth = d.thickness;
        ctx.moveTo(d.x, d.y);
        ctx.lineTo(d.x + d.sway*6, d.y + d.len);
        ctx.stroke();
      }
      requestAnimationFrame(animate);
    }
    window.addEventListener('resize', adjust);
    adjust(); requestAnimationFrame(animate);
  })();

  /*******************************
   *  Thunder ambience (WebAudio)
   *  - very low volume rumble + occasional low "thump"
   *******************************/
  const AudioEngine = (function(){
    let ctx = null;
    let masterGain = null;
    let rumbleGain = null;
    let isRunning = false;
    function init() {
      if (ctx) return;
      try {
        ctx = new (window.AudioContext || window.webkitAudioContext)();
      } catch (e) { console.warn('AudioContext not available'); return; }
      masterGain = ctx.createGain();
      masterGain.gain.value = 0.0; // start muted
      masterGain.connect(ctx.destination);

      // low-frequency rumble using noise filtered
      const bufferSize = 2*ctx.sampleRate;
      const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
      const output = noiseBuffer.getChannelData(0);
      for (let i=0;i<bufferSize;i++) output[i] = Math.random()*2-1;
      const noise = ctx.createBufferSource();
      noise.buffer = noiseBuffer;
      noise.loop = true;
      const noiseFilter = ctx.createBiquadFilter();
      noiseFilter.type = 'lowpass';
      noiseFilter.frequency.value = 80; // very low
      noiseFilter.Q.value = 0.8;

      rumbleGain = ctx.createGain();
      rumbleGain.gain.value = 0.02; // base rumble level (very low)
      noise.connect(noiseFilter);
      noiseFilter.connect(rumbleGain);
      rumbleGain.connect(masterGain);

      noise.start();

      // occasional thunder "thump" via low oscillator + gain envelope
      function thunderPulse() {
        const osc = ctx.createOscillator();
        const g = ctx.createGain();
        osc.type = 'sine';
        const freq = Math.random()*10 + 20; // 20-30Hz
        osc.frequency.value = freq;
        g.gain.value = 0.0;
        osc.connect(g);
        g.connect(masterGain);
        const now = ctx.currentTime;
        g.gain.cancelScheduledValues(now);
        // envelope
        g.gain.setValueAtTime(0, now);
        g.gain.linearRampToValueAtTime(0.08 * Math.random(), now + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, now + 2.2 + Math.random()*1.8);
        osc.start(now);
        osc.stop(now + 3.0 + Math.random()*2.0);
      }

      // schedule occasional thunder
      function scheduleThunder() {
        const delay = 6 + Math.random()*22; // every 6-28s
        setTimeout(() => { thunderPulse(); scheduleThunder(); }, delay*1000);
      }
      scheduleThunder();
      isRunning = true;
    }
    function setVolume(v) { if (masterGain) masterGain.gain.setTargetAtTime(v, (ctx||{}).currentTime || 0, 0.1); }
    function resumeOnGesture() {
      if (!ctx) init();
      if (!ctx) return;
      if (ctx.state === 'suspended') ctx.resume().catch(()=>{});
    }
    return {
      init, setVolume, resumeOnGesture, isRunning: ()=>!!isRunning
    };
  })();

  // UI: sound toggle
  const audioToggle = document.getElementById('audioToggle');
  const soundStatus = document.getElementById('soundStatus');
  let ambienceOn = false;
  audioToggle.addEventListener('click', () => {
    // ensure audio context is created/resumed on a user gesture
    AudioEngine.resumeOnGesture();
    if (!ambienceOn) {
      AudioEngine.setVolume(0.02); // very subtle
      ambienceOn = true;
      soundStatus.textContent = 'On (subtle)';
      audioToggle.textContent = 'ðŸ”Š Ambience';
    } else {
      AudioEngine.setVolume(0.0);
      ambienceOn = false;
      soundStatus.textContent = 'Muted';
      audioToggle.textContent = 'ðŸ”ˆ Ambience';
    }
  });

  // create AudioEngine but keep muted until toggle/resume
  AudioEngine.init();
  AudioEngine.setVolume(0.0);

  /*******************************
   *  Notes data - expanded original notes
   *******************************/
  const NOTES = {
    mathematics: {
      title: "Mathematics â€” IGCSE / AS Core",
      price: 6.99,
      content: `Mathematics â€” In-depth Study Notes

SECTION A â€” Number & Algebra
1. Number types & properties
- Integers, fractions, decimals, rational and irrational numbers. Surds: simplify sqrt(a*b) where possible, rationalise denominators: multiply numerator & denominator by conjugate when necessary.
- Significant figures & rounding rules. Standard (scientific) notation: express as a Ã— 10^n (1 â‰¤ a < 10).

2. Indices & roots
- Laws: a^m Ã— a^n = a^(m+n); a^m / a^n = a^(m-n); (a^m)^n = a^(mn); a^0 = 1; a^-n = 1/a^n.
- Fractional indices: a^(1/n) = nth root of a. Simplify carefully.

3. Algebra manipulation
- Expand, factorise (including difference of squares, perfect square trinomials).
- Solve linear and quadratic equations: factorisation, completing the square, quadratic formula x = [-b Â± âˆš(b^2-4ac)]/(2a).
- Simultaneous equations: substitution and elimination. Handle linearâ€“quadratic systems with substitution into quadratic.

4. Inequalities
- Solve and express using interval notation. For quadratics, use sign tables or test points. Remember to flip inequality when multiplying by negative.

SECTION B â€” Geometry & Trigonometry
5. Coordinate geometry
- Equation of a line: y = mx + c (m = gradient). Distance formula âˆš[(x2-x1)^2+(y2-y1)^2]. Midpoint formula.
- Circle equation (x - a)^2 + (y - b)^2 = r^2; convert parabolas by completing square.

6. Trigonometry
- sin, cos, tan definitions (right triangle) and unit circle approach. Convert degrees â†” radians: Ï€ rad = 180Â°.
- Laws: sine rule a/sinA = b/sinB = c/sinC; cosine rule c^2 = a^2 + b^2 - 2ab cosC.
- Identities: sin^2Î¸ + cos^2Î¸ = 1; use identities to solve trig equations in given domains.

SECTION C â€” Calculus & Applications
7. Differentiation
- Derivative meaning: instantaneous rate of change. Power rule, product, quotient, chain rules. Differentiate sin, cos, e^x, ln x.
- Applications: stationary points (f'(x)=0), classify with second derivative, tangents and normals, motion: v = ds/dt, a = dv/dt.

8. Integration
- Antiderivatives, definite integrals as areas. Fundamental Theorem connects integration and differentiation.
- Methods: substitution, integration by parts. Use integrals to find areas between curves and volumes of revolution.

SECTION D â€” Probability & Statistics
9. Probability basics
- Mutually exclusive vs independent events. Conditional probability P(A|B) = P(A and B)/P(B).
- Expectation value and variance basics.

10. Statistics
- Mean, median, mode, range, variance, standard deviation. Interpret histograms, box plots, cumulative frequency.
- Simple linear regression concepts and correlation coefficient interpretation.

Exam & Study Tips:
- Always show steps. Write exact answers where required. Draw labelled diagrams for geometry/trig problems. Practice a mix of routine and non-routine problems.`
    },
    physics: {
      title: "Physics â€” IGCSE / AS Core",
      price: 6.99,
      content: `Physics â€” In-depth Study Notes

MECHANICS
1. Kinematics
- Scalars vs vectors. Position, displacement, speed, velocity, acceleration. SUVAT equations for constant acceleration:
  s = ut + 0.5 a t^2
  v = u + a t
  v^2 = u^2 + 2 a s

2. Dynamics
- Newton's laws:
  * 1st law (inertia)
  * 2nd law F = m a (net force causes acceleration)
  * 3rd law (action-reaction)
- Free-body diagrams: break forces into components, sum forces in each direction = ma.

3. Energy & Momentum
- Work W = Fâ‹…s (dot product). Kinetic energy KE = 1/2 m v^2, gravitational potential energy U = m g h. Conservation of energy principles and mechanical energy including losses to heat.
- Momentum p = m v; impulse = Î”p = F Î”t; momentum conserved in closed systems (inelastic vs elastic collisions).

WAVES & OPTICS
4. Wave properties
- Wavelength Î», frequency f, speed v related by v = f Î». Superposition, interference, standing waves (nodes/antinodes).
- Sound: pitch (frequency) and loudness (amplitude). Doppler effect: apparent frequency shift due to motion.

5. Optics
- Reflection & refraction: angle of incidence = angle of reflection. Snell's law n1 sinÎ¸1 = n2 sinÎ¸2. Total internal reflection when angle > critical angle (sin c = n2/n1).
- Lens formula 1/f = 1/v + 1/u and magnification.

ELECTRICITY & MAGNETISM
6. Circuits
- Charge Q (Coulombs), current I = Q/t, voltage (potential difference) V. Ohm's law V = I R. Series and parallel circuit rules; Kirchhoffâ€™s laws.
- Power P = VI = I^2 R = V^2 / R.

7. Electromagnetism
- Magnetic fields around currents, force on a current in a magnetic field (F = I L Ã— B), electromagnetic induction (Faraday's law E = -dÎ¦/dt).

THERMAL & MODERN
8. Thermal physics
- Heat transfer: conduction, convection, radiation. Specific heat capacity Q = m c Î”T, latent heat Q = m L.
9. Modern physics
- Photoelectric effect E = h f; quantised energy levels; radioactive decay with activity A = Î» N and exponential decay N(t) = N0 e^{-Î» t}.

Measurement & Practical Skills:
- SI units, uncertainties and propagation, graphical analysis (gradient & area).`
    },
    chemistry: {
      title: "Chemistry â€” IGCSE / AS Core",
      price: 6.99,
      content: `Chemistry â€” In-depth Study Notes

ATOMIC & PERIODIC
1. Atomic structure
- Proton, neutron, electron. Atomic number Z, mass number A. Isotopes: same Z differing neutrons.
- Electron configuration principles (Aufbau, Hund's rule). Periodic trends: ionisation energy, atomic radius, electronegativity.

BONDING & STRUCTURE
2. Bond types
- Ionic: electron transfer, high melting points, conduction when molten/aqueous.
- Covalent: shared electron pairs; single, double, triple bonds. Polar covalent bonds from EN differences.
- Metallic: sea of electrons, conductivity, ductility.

3. Intermolecular forces
- London dispersion, dipoleâ€“dipole, hydrogen bonding. Influence on boiling/melting points and solubility.

STOICHIOMETRY & QUANTITATIVE
4. Moles and calculations
- Moles n = mass / molar mass; Avogadro's number 6.022Ã—10^23. Balanced equations for stoichiometric conversions, limiting reagent, percentage yield.
- Concentration c = n / V (mol L^-1). Titration technique and calculations.

THERMOCHEMISTRY & KINETICS
5. Energetics
- Exothermic vs endothermic; enthalpy change Î”H. Hess's law for indirect enthalpy calculations.
6. Rates & equilibrium
- Collision theory: rate depends on frequency of effective collisions; factors: concentration, temperature, surface area, catalysts.
- Chemical equilibrium: dynamic equilibrium, Kc expression, Le Chatelierâ€™s principle for disturbance response.

ORGANIC CHEMISTRY
7. Functional groups & reactions
- Alkanes, alkenes, alkynes, alcohols, haloalkanes, carbonyls, carboxylic acids, esters, amines. Addition, substitution, oxidation reactions.
- Isomerism: structural (chain/position/functional) and stereoisomerism (E/Z).

Laboratory practice:
- Safe handling, accurate measurement using volumetric glassware, interpreting tests (flame tests, solubility, pH).`
    },
    biology: {
      title: "Biology â€” IGCSE / AS Core",
      price: 6.99,
      content: `Biology â€” In-depth Study Notes

CELLS & BIOCHEMISTRY
1. Cell structure
- Prokaryotic vs eukaryotic. Organelles: nucleus (DNA), mitochondria (ATP), ribosomes (protein synthesis), chloroplasts (photosynthesis).
- Membrane structure: phospholipid bilayer, proteins; transport: diffusion, osmosis, facilitated diffusion, active transport.

2. Biomolecules
- Carbohydrates, lipids, proteins, nucleic acids. Enzymes: active site, lock-and-key, factors affecting activity (pH, temp, substrate concentration).

GENETICS & EVOLUTION
3. DNA & protein synthesis
- DNA replication, transcription to mRNA, translation to polypeptides. Codons and genetic code features.
4. Inheritance
- Mendelian inheritance, genotypes & phenotypes, sex linkage, co-dominance, pedigree analysis.
5. Evolution
- Natural selection, adaptation, evidence from fossils and molecular biology.

PHYSIOLOGY & ECOLOGY
6. Plant & animal physiology
- Photosynthesis (light-dependent reactions and Calvin cycle), respiration (aerobic vs anaerobic), transport systems (xylem & phloem; circulatory system in animals).
7. Ecology
- Ecosystems, nutrient cycles (carbon, nitrogen), food webs, energy transfer efficiency, conservation.

Practical skills:
- Experimental design, statistical interpretation, microscopy techniques.`
    },
    english: {
      title: "English Language â€” Skills & Techniques",
      price: 6.99,
      content: `English Language â€” Detailed Notes

READING
1. Comprehension & analysis
- Determine purpose, tone, viewpoint. Identify main ideas, supporting detail, inferences. Locate evidence and explain its effect.

2. Language devices
- Figurative language (metaphor, simile), imagery, rhetorical devices (repetition, triads, rhetorical questions). Consider connotation & denotation.

WRITING
3. Structure & style
- Plan: introduction (thesis), body paragraphs (topic sentence, evidence, explanation), conclusion. Adapt register and tone.
4. Persuasive writing
- Use persuasive techniques: ethos (credibility), pathos (emotion), logos (logic). Use facts, rhetorical devices, and counterarguments.

GRAMMAR & VOCAB
5. Sentence variety & punctuation
- Use simple/compound/complex sentences for rhythm. Use commas, semicolons and colons correctly. Avoid run-on sentences and fragments.

EXAM TECHNIQUE:
- Annotate stimulus, quote briefly and explain effect, watch time and plan.`
    },
    economics: {
      title: "Economics â€” Core Concepts",
      price: 6.99,
      content: `Economics â€” Detailed Notes

MICROECONOMICS
1. Scarcity & choice
- Opportunity cost, production possibility frontier (PPF), specialization and trade.

2. Demand & supply
- Determinants, elasticity (price, income, cross), equilibrium, surplus/shortage, government intervention (taxes, subsidies, price controls).

3. Market structures
- Perfect competition, monopoly, oligopoly â€” implications for price, output and efficiency. Market failure examples: externalities, public goods, information asymmetry.

MACROECONOMICS
4. Aggregate demand & supply
- Components of AD (C + I + G + X âˆ’ M). Fiscal policy and monetary policy tools, inflation and unemployment measures.

5. International trade & development
- Comparative advantage, trade barriers and balance of payments basics.

Evaluation & diagrams:
- Always draw and label diagrams, show shifts vs movements, explain short-run vs long-run impacts.`
    },
    history: {
      title: "History â€” Modern World Themes",
      price: 6.99,
      content: `History â€” Detailed Notes

1. Causes of major conflicts
- Underlying causes: imperial rivalry, nationalism, militarism, alliances; short-term triggers (e.g., assassination spark in WWI).
2. World Wars & consequences
- Trench warfare, total war economy, societal impacts, treaties (e.g., Versailles) and their political/economic consequences.
3. Interwar period & extremism
- Economic instability (Great Depression), rise of totalitarian regimes, propaganda and consolidation of power.
4. Cold War
- Ideological struggle, proxy wars, dÃ©tente and resolution with Soviet collapse.
5. Decolonisation
- Independence movements, neocolonial economic patterns, border and ethnic conflicts post-independence.

Use targeted case studies with dates and key figures; practice source evaluation (origin, purpose, content, value & limitations).`
    },
    computer_science: {
      title: "Computer Science â€” IGCSE / AS Intro",
      price: 6.99,
      content: `Computer Science â€” Detailed Notes

1. Fundamentals
- Data types: integer, float, boolean, string; variables and expressions.
- Binary & hexadecimal number systems; converting between bases; binary addition, two's complement for negatives.

2. Algorithms & Problem Solving
- Pseudocode & flowcharts. Common algorithms: linear search, binary search, sorting (bubble, insertion, merge, quick outlines).
- Complexity basics: time complexity O(n), O(n log n), space considerations.

3. Programming concepts
- Control flow (sequence, selection, iteration), functions, parameters & scope, recursion basics.
- Data structures: arrays/lists, stacks, queues, dictionaries/maps, trees intro.

4. Computer systems & networks
- CPU basics, memory hierarchy (RAM vs storage), input/output devices. Networking fundamentals: protocols, IP addressing, client-server models.

Practical programming:
- Write clean pseudocode, trace code for dry runs, test on edge cases and verify outputs.`
    },
    business: {
      title: "Business Studies â€” Intro",
      price: 6.99,
      content: `Business Studies â€” Detailed Notes

1. Business activity & objectives
- Types of businesses (sole trader, partnership, company), objectives (profit, growth, social goals).

2. Marketing & finance
- Marketing mix (4Ps), market research methods, cash flow basics, profit vs cash, basic financial statements (income, balance sheet).

3. Operations & HR
- Production processes, quality control, recruitment, training, motivation theories (Maslow, Herzberg).

Strategy & decisions:
- SWOT analysis, break-even analysis, and the role of entrepreneurs. Use case studies and data to support recommendations.`
    },
    geography: {
      title: "Geography â€” Physical & Human",
      price: 6.99,
      content: `Geography â€” Detailed Notes

PHYSICAL GEOGRAPHY
1. Tectonics & landforms
- Plate boundaries: constructive, destructive, conservative; earthquake and volcano causes and effects.
- Weathering, erosion, mass movement and coastal processes.

2. Climate & ecosystems
- Climate controls, biomes, tropical rainforest and desert adaptations, water cycle and river landforms.

HUMAN GEOGRAPHY
3. Urbanisation & development
- Urban growth causes, challenges of megacities, sustainable strategies.
4. Population & resources
- Demographic transition model, population policies, food/water security issues.

Use maps, diagrams and case studies; interpret data and propose sustainable solutions.`
    },
    sociology: {
      title: "Sociology â€” Introductory",
      price: 6.99,
      content: `Sociology â€” Detailed Notes

1. Key concepts
- Society, culture, norms, values, socialisation, social roles.

2. Family & education
- Family types, functions, influences of education on social mobility; theories: functionalist, Marxist, interactionist summaries.

3. Crime & deviance
- Definitions, causes, social responses, labelling theory, punishment approaches.

Research methods:
- Qualitative vs quantitative methods, sampling, ethical issues and validity/reliability considerations.`
    },
    islamiyat: {
      title: "Islamiyat â€” Core Topics",
      price: 6.99,
      content: `Islamiyat â€” Detailed Notes

1. Core beliefs
- Tawhid (Oneness of God), prophethood, the afterlife (Akhirah), angels, scriptures (Quran), predestination (Qadr) concepts. Practical implications: worship, ethics, and community.

2. Pillars & practices
- Shahada, Salah, Zakat, Sawm (Ramadan), Hajj â€” meanings, purposes, and social functions.

3. Life & morality
- Family ethics, social justice, rights and responsibilities, Islamic rulings on behaviour, emphasis on balance and compassion.

4. Historical & contextual insights
- Prophetic biography highlights relevant to teachings, major schools of thought overview and how Islamic principles apply to modern issues.

Study advice:
- Use primary verses & authenticated hadiths where required; always explain meaning and context; compare scholarly views for evaluation-type questions.`
    }
  };

  /*******************************
   *  Storage & UI helpers
   *******************************/
  const STORAGE_KEY = 'caie_forest_unlocked_v2';
  function loadUnlocked() {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
    catch { return []; }
  }
  function saveUnlocked(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
  function isUnlocked(key) { return loadUnlocked().includes(key); }
  function unlock(key) {
    const arr = loadUnlocked();
    if (!arr.includes(key)) { arr.push(key); saveUnlocked(arr); }
  }
  function lockAll() { saveUnlocked([]); }
  function unlockAll() { saveUnlocked(Object.keys(NOTES)); }

  // DOM refs
  const subjectsGrid = document.getElementById('subjectsGrid');
  const modal = document.getElementById('modal');
  const modalBackdrop = document.getElementById('modalBackdrop');
  const modalTitle = document.getElementById('modalTitle');
  const modalSubtitle = document.getElementById('modalSubtitle');
  const modalContent = document.getElementById('modalContent');
  const modalClose = document.getElementById('modalClose');
  const modalDownload = document.getElementById('modalDownload');
  const modalPrint = document.getElementById('modalPrint');

  // create card
  function createCard(key, data) {
    const unlocked = isUnlocked(key);
    const card = document.createElement('div');
    card.className = 'p-4 rounded-xl card-hover glass';
    card.innerHTML = `
      <div class="flex items-start justify-between gap-4">
        <div class="flex-1">
          <h4 class="text-lg font-semibold text-sky-100">${data.title}</h4>
          <p class="text-slate-300 mt-2">${shortPreview(data.content, 140)}</p>
          <div class="mt-3 flex gap-2">
            <span class="text-xs text-slate-300/80 px-2 py-1 rounded bg-white/3">$${data.price.toFixed(2)}</span>
            <span class="text-xs text-slate-300">Syllabus-style notes</span>
          </div>
        </div>
        <div class="flex flex-col items-end gap-2">
          ${unlocked ? '<button class="openBtn px-3 py-2 border rounded text-sky-100">Open</button><button class="downloadBtn px-3 py-2 border rounded text-sky-100">Download</button>' : '<button class="unlockBtn px-3 py-2 rounded-md bg-indigo-600">Unlock $6.99</button>'}
        </div>
      </div>
    `;
    // attach actions
    setTimeout(()=> {
      const unlockBtn = card.querySelector('.unlockBtn');
      const openBtn = card.querySelector('.openBtn');
      const downloadBtn = card.querySelector('.downloadBtn');
      if (unlockBtn) unlockBtn.addEventListener('click', ()=>handleUnlock(key));
      if (openBtn) openBtn.addEventListener('click', ()=>openModal(key));
      if (downloadBtn) downloadBtn.addEventListener('click', ()=>downloadSubject(key));
    }, 0);
    return card;
  }

  function shortPreview(text, n) {
    const t = text.replace(/\n+/g,' ').trim();
    return t.length > n ? t.slice(0,n).trim() + 'â€¦' : t;
  }

  function renderSubjects() {
    subjectsGrid.innerHTML = '';
    for (const [k,d] of Object.entries(NOTES)) {
      subjectsGrid.appendChild(createCard(k,d));
    }
  }

  /*******************************
   *  Modal functions
   *******************************/
  function openModal(key) {
    const d = NOTES[key];
    modalTitle.textContent = d.title;
    modalSubtitle.textContent = isUnlocked(key) ? 'Full notes unlocked' : 'Preview';
    modalContent.textContent = isUnlocked(key) ? d.content : (d.content.split('\n').slice(0,18).join('\n') + '\n\n[...preview â€” unlock to read full notes]');
    modal.classList.remove('hidden');
    // handlers
    modalDownload.onclick = () => downloadString(`${d.title}.txt`, `${d.title}\n\n${d.content}`);
    modalPrint.onclick = () => {
      const w = window.open('', '_blank', 'width=900,height=700');
      w.document.write(`<pre style="white-space:pre-wrap;font-family:inherit;font-size:14px;">${escapeHtml(d.title + "\n\n" + d.content)}</pre>`);
      w.document.close();
      setTimeout(()=>w.print(), 250);
    };
  }
  function closeModal() { modal.classList.add('hidden'); }
  modalBackdrop.addEventListener('click', closeModal);
  modalClose.addEventListener('click', closeModal);

  function handleUnlock(key) {
    // Simulated purchase animation/flow
    const yes = confirm(`Simulated purchase: Unlock "${NOTES[key].title}" for $6.99? (Demo â€” stored locally in your browser)`);
    if (!yes) return;
    unlock(key);
    renderSubjects();
    openModal(key);
  }

  function downloadSubject(key) {
    const d = NOTES[key];
    downloadString(`${d.title}.txt`, `${d.title}\n\n${d.content}`);
  }

  function downloadString(filename, text) {
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function escapeHtml(s) {
    return s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
  }

  /*******************************
   * Topbar buttons
   *******************************/
  document.getElementById('unlockAllBtn').addEventListener('click', ()=>{
    if (confirm('Simulated: unlock all notes in this browser?')) { unlockAll(); renderSubjects(); alert('All unlocked (demo).'); }
  });
  document.getElementById('downloadAllBtn').addEventListener('click', ()=>{
    let combined = '';
    for (const d of Object.values(NOTES)) combined += `=== ${d.title} ===\n\n${d.content}\n\n\n`;
    downloadString('CAIE_All_Notes.txt', combined);
  });
  document.getElementById('lockBtn').addEventListener('click', ()=>{
    if (confirm('Lock (clear) unlocked subjects?')) { lockAll(); renderSubjects(); alert('All locked.'); }
  });
  document.getElementById('aboutBtn').addEventListener('click', ()=>{
    alert('Notes are original educational summaries written to align with common CAIE topics. They are not official Cambridge text. Use Download to save files.');
  });

  // keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if (e.shiftKey && e.key.toLowerCase()==='l') { if (confirm('Lock (clear) unlocked subjects?')) { lockAll(); renderSubjects(); alert('All locked.'); } }
    if (e.key === 'Escape') closeModal();
  });

  // init render
  renderSubjects();
  document.getElementById('year').textContent = new Date().getFullYear();

  // show welcome once
  if (!localStorage.getItem('caie_forest_seen')) {
    alert('Welcome â€” this file contains original CAIE-style notes. Purchases are simulated and stored locally in your browser. Press Ambience to enable very subtle storm sounds.');
    localStorage.setItem('caie_forest_seen', '1');
  }

  </script>
</body>
</html>
