<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CAIE Notes â€” Forest Rain UI Demo PayFast</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body { height: 100%; margin:0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    #bg {
      position: fixed;
      inset: 0;
      background-image: url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1950&q=80');
      background-size: cover;
      background-position: center;
      filter: saturate(0.9) contrast(0.9);
      z-index: -3;
    }
    #overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg, rgba(6,21,38,0.45) 0%, rgba(2,6,23,0.6) 100%);
      z-index: -2;
    }
    #rainCanvas {
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
      mix-blend-mode: screen;
      opacity: 0.85;
    }
    .glass {
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(6px) saturate(1.1);
      border: 1px solid rgba(255,255,255,0.06);
    }
    .card-hover:hover { transform: translateY(-6px); box-shadow: 0 12px 30px rgba(2,6,23,0.55); }
    .note-content { white-space: pre-wrap; line-height: 1.6; color: #e6eef8; }
    .grid-cols-responsive { grid-template-columns: repeat(1, minmax(0,1fr)); }
    @media(min-width: 640px) { .grid-cols-responsive { grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media(min-width: 1024px) { .grid-cols-responsive { grid-template-columns: repeat(3, minmax(0,1fr)); } }
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: flex-end;
    }
    .btn-group button {
      min-width: 96px;
    }
  </style>
</head>
<body class="min-h-screen text-slate-100">

  <div id="bg" aria-hidden="true"></div>
  <div id="overlay" aria-hidden="true"></div>
  <canvas id="rainCanvas" aria-hidden="true"></canvas>

  <div class="relative z-10 min-h-screen flex flex-col">
    <header class="py-6">
      <div class="max-w-6xl mx-auto px-4 flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-extrabold tracking-tight drop-shadow-md">ðŸŒ² CAIE Notes â€” Forest Edition Demo PayFast</h1>
          <p class="text-slate-300 mt-1">Demo: Unlock buttons open PayFast payment page URL in new tab.</p>
        </div>
        <div class="flex items-center gap-3">
          <button id="unlockAllBtn" class="px-3 py-2 rounded-md glass text-sky-200 hover:bg-white/5 transition">Unlock All</button>
          <button id="exportAllBtn" class="px-3 py-2 rounded-md glass text-sky-200 hover:bg-white/5 transition">Download All</button>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="max-w-6xl mx-auto px-4 pb-12">
        <section class="grid gap-6 grid-cols-responsive">
          <div class="glass rounded-2xl p-6 flex flex-col gap-4">
            <h2 class="text-xl font-semibold">How it works (Demo)</h2>
            <p class="text-slate-300">Click Unlock on a subject to open a simulated PayFast payment page URL in a new tab (no actual payment).</p>
            <div class="flex gap-3">
              <button id="demoLockBtn" class="px-4 py-2 bg-indigo-600 rounded-md shadow hover:brightness-105">Demo: Lock All (Shift+L)</button>
              <button id="demoInfoBtn" class="px-4 py-2 border rounded-md">About Notes</button>
            </div>
          </div>

          <div class="glass rounded-2xl p-6 col-span-1 lg:col-span-2">
            <h3 class="text-lg font-semibold mb-4">Subjects</h3>
            <div id="subjectsGrid" class="grid gap-4 grid-cols-responsive"></div>
          </div>
        </section>

        <div class="mt-8 text-slate-300 text-sm text-center">Tip: Press <strong>Shift + L</strong> to lock (clear) unlocked subjects. Â© <span id="year"></span></div>
      </div>
    </main>
  </div>

  <div id="modal" class="fixed inset-0 hidden items-center justify-center z-20">
    <div class="absolute inset-0 bg-black/50" id="modalBackdrop"></div>
    <div class="relative max-w-4xl w-full mx-4">
      <div class="bg-gradient-to-r from-slate-900/80 to-slate-800/70 rounded-2xl p-6 glass shadow-2xl overflow-hidden">
        <div class="flex items-start justify-between gap-4">
          <h2 id="modalTitle" class="text-2xl font-bold text-sky-100"></h2>
          <div class="flex gap-2">
            <button id="modalDownload" class="px-3 py-2 border rounded text-sky-100 hover:bg-white/10 transition">Download</button>
            <button id="modalPrint" class="px-3 py-2 border rounded text-sky-100 hover:bg-white/10 transition">Print</button>
            <button id="modalClose" class="px-3 py-2 bg-red-600 rounded text-white hover:bg-red-700 transition">Close</button>
          </div>
        </div>
        <div class="mt-4 max-h-[60vh] overflow-auto note-content" id="modalContent" style="padding-right:12px;"></div>
      </div>
    </div>
  </div>

  <script>
  (function() {
    const canvas = document.getElementById('rainCanvas');
    const ctx = canvas.getContext('2d');
    let w = canvas.width = innerWidth;
    let h = canvas.height = innerHeight;
    const drops = [];
    const DROP_COUNT = Math.floor((w * h) / 12000);

    function rand(min, max) { return Math.random() * (max - min) + min; }
    function reset() {
      w = canvas.width = innerWidth;
      h = canvas.height = innerHeight;
      drops.length = 0;
      for (let i = 0; i < DROP_COUNT; i++) {
        drops.push({
          x: Math.random() * w,
          y: Math.random() * h,
          len: rand(10, 24),
          velY: rand(300, 900) / 1000,
          thickness: rand(0.8, 1.8),
          sway: rand(-0.6, 0.6),
          opacity: rand(0.12, 0.28)
        });
      }
    }
    let last = performance.now();
    function draw(now) {
      const dt = (now - last) / 1000; last = now;
      ctx.clearRect(0,0,w,h);
      const grad = ctx.createLinearGradient(0,0,0,h);
      grad.addColorStop(0, 'rgba(255,255,255,0)');
      grad.addColorStop(1, 'rgba(0,0,0,0.08)');
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,w,h);
      ctx.lineCap = 'round';
      for (let d of drops) {
        d.y += d.velY * 1200 * dt;
        d.x += Math.sin((d.y + now * 0.001) * 0.002) * (d.sway * 2);
        if (d.y > h + 30) { d.y = -20; d.x = Math.random() * w; }
        ctx.beginPath();
        ctx.strokeStyle = `rgba(200,230,255,${d.opacity})`;
        ctx.lineWidth = d.thickness;
        ctx.moveTo(d.x, d.y);
        ctx.lineTo(d.x + d.sway * 8, d.y + d.len);
        ctx.stroke();
      }
      requestAnimationFrame(draw);
    }
    window.addEventListener('resize', reset);
    reset();
    requestAnimationFrame(draw);
  })();

  const NOTES = {
    "mathematics": {
      title: "Mathematics (IGCSE / AS-A Level core concepts)",
      price: 4.99,
      content:
`Mathematics â€” Comprehensive Study Notes

1. Number System & Arithmetic
- Real numbers: integers, rationals, irrationals, decimals and surds. Rationalize denominators; simplify surds using prime factorization.
- Indices (exponents): product, quotient, negative and fractional indices. Use index rules to simplify algebraic expressions.
- Standard form: a Ã— 10^n with 1 â‰¤ a < 10; useful for significant figures.

2. Algebra
- Simplifying expressions, factorisation, completing the square. Solve linear, quadratic and simultaneous equations. Inequalities and functions (domain, range).

3. Coordinate Geometry & Graphs
- Lines (y = mx + c); circles and parabolas; transformations and sketching.

4. Trigonometry
- sin, cos, tan; radian measure; sine & cosine rules for general triangles.

5. Calculus (AS/A-level)
- Limits, differentiation (power, product, chain rules), integration, applications (area, kinematics).

6. Vectors & Geometry
- Vector addition, scalar multiples, dot product, geometric proofs.

7. Probability & Statistics
- Basic probability, permutations/combinations, mean/median/mode, variance & standard deviation.

Exam tips:
- Show full working. Use exact forms (fractions/surds) when asked. Practice past papers.`
    },
    "physics": {
      title: "Physics (IGCSE / AS-A Level core concepts)",
      price: 4.99,
      content:
`Physics â€” Comprehensive Study Notes

1. Mechanics
- Kinematics: displacement, velocity, acceleration. SUVAT equations for constant acceleration.
- Forces & Newton's laws: F = ma, free-body diagrams, equilibrium.

2. Energy & Momentum
- Work, energy, power: KE = 1/2 mv^2, PE = mgh. Conservation of energy and momentum.

3. Waves & Optics
- Wave properties, refraction (Snell's law), lens formula 1/f = 1/u + 1/v.

4. Electricity & Magnetism
- Current, voltage, resistance (Ohm's law). Circuits, EM induction (Faraday's law).

5. Thermal Physics & Modern Physics
- Specific heat, latent heat, photoelectric effect basics.

Practical:
- Use units, show calculations, handle uncertainties.`
    },
    "chemistry": {
      title: "Chemistry (IGCSE / AS-A Level core concepts)",
      price: 4.99,
      content:
`Chemistry â€” Comprehensive Study Notes

1. Atomic Structure & Periodic Table
- Atoms, isotopes, electron configurations and periodic trends.

2. Bonding & Structure
- Ionic, covalent, metallic bonding; intermolecular forces.

3. Quantitative Chemistry
- Mole concept, stoichiometry, titration calculations, concentration (mol/L).

4. Energetics & Equilibrium
- Exothermic/endothermic, Hess' law, Le Chatelier's principle, rate laws.

5. Organic Basics
- Functional groups, isomerism, common reaction types (addition, substitution, oxidation).

Lab tips:
- Familiarise with titration technique and safe handling.`
    },
    "biology": {
      title: "Biology (IGCSE / AS-A Level core concepts)",
      price: 4.99,
      content:
`Biology â€” Comprehensive Study Notes

1. Cell Biology
- Structure of prokaryotic and eukaryotic cells; membrane transport (diffusion, osmosis, active transport).

2. Genetics
- DNA, transcription, translation, meiosis & mitosis, inheritance patterns.

3. Human & Plant Physiology
- Circulatory, respiratory, digestive systems; photosynthesis and plant transport.

4. Ecology & Evolution
- Food webs, energy flow, natural selection, speciation.

Practical:
- Emphasise experimental design, control variables and repeatability.`
    },
    "english": {
      title: "English Language (IGCSE) â€” Reading & Writing Skills",
      price: 4.99,
      content:
`English Language â€” Comprehensive Study Notes

1. Reading
- Identify main idea, tone, purpose, register. Analyse language features (imagery, rhetorical devices).

2. Writing
- Plan structure, paragraph development, tone adaptation. Persuasive techniques and descriptive detail.

3. Grammar
- Sentence structures, punctuation rules, avoiding common errors.

Exam tips:
- Annotate passages, use relevant quotes and explain their effect.`
    },
    "economics": {
      title: "Economics (IGCSE / AS Intro)",
      price: 4.99,
      content:
`Economics â€” Comprehensive Study Notes

1. Basic Economic Problem
- Scarcity, choices, opportunity cost, PPF concept.

2. Demand & Supply
- Determinants, elasticity (PED/PES), movements vs shifts.

3. Macroeconomics
- AD components, inflation, unemployment, fiscal & monetary policy.

4. Market Failure & Trade
- Externalities, public goods, comparative advantage.`
    },
    "history": {
      title: "History (Modern World themes)",
      price: 4.99,
      content:
`History â€” Comprehensive Study Notes

1. Causes of Conflict
- Nationalism, imperialism, alliances, triggers and long-term causes.

2. 20th Century Themes
- World Wars, interwar instability, rise of extremist regimes, Cold War overview.

3. Decolonisation & Development
- Processes of independence, economic and social challenges.

Exam tips:
- Use specific examples and dates, practice source evaluation and cause-effect analysis.`
    }
  };

  const STORAGE_KEY = 'caie_forest_unlocked_v1';
  function loadUnlocked() {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
    catch { return []; }
  }
  function saveUnlocked(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
  function isUnlocked(k) { return loadUnlocked().includes(k); }
  function unlock(k) { const arr = loadUnlocked(); if (!arr.includes(k)) { arr.push(k); saveUnlocked(arr); } }
  function lockAll() { saveUnlocked([]); }
  function unlockAll() { saveUnlocked(Object.keys(NOTES)); }

  const subjectsGrid = document.getElementById('subjectsGrid');
  const modal = document.getElementById('modal');
  const modalBackdrop = document.getElementById('modalBackdrop');
  const modalTitle = document.getElementById('modalTitle');
  const modalContent = document.getElementById('modalContent');
  const modalClose = document.getElementById('modalClose');
  const modalDownload = document.getElementById('modalDownload');
  const modalPrint = document.getElementById('modalPrint');

  function createCard(key, data) {
    const unlocked = isUnlocked(key);
    const div = document.createElement('div');
    div.className = 'p-4 rounded-xl glass card-hover transition transform';
    div.innerHTML = `
      <div class="flex items-start justify-between gap-3">
        <div class="flex-1 pr-4">
          <h4 class="text-lg font-semibold text-sky-100">${data.title}</h4>
          <p class="text-sm text-slate-300 mt-2">${data.content.split('\\n')[0].slice(0,120)}...</p>
        </div>
        <div class="text-right btn-group">
          <div>
            <span class="text-xs text-slate-300">Price</span>
            <div class="text-xl font-bold text-sky-200">$${data.price.toFixed(2)}</div>
          </div>
          ${unlocked
            ? `<button class="openBtn px-3 py-2 rounded-md border text-sky-100 hover:bg-white/10 transition">Open</button>
               <button class="downloadBtn px-3 py-2 rounded-md border text-sky-100 hover:bg-white/10 transition">Download</button>`
            : `<button class="unlockBtn px-3 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 transition">Unlock</button>`}
        </div>
      </div>
    `;
    setTimeout(() => {
      const unlockBtn = div.querySelector('.unlockBtn');
      const openBtn = div.querySelector('.openBtn');
      const downloadBtn = div.querySelector('.downloadBtn');
      if (unlockBtn) unlockBtn.addEventListener('click', () => handleUnlock(key));
      if (openBtn) openBtn.addEventListener('click', () => openModal(key));
      if (downloadBtn) downloadBtn.addEventListener('click', () => downloadSubject(key));
    }, 0);
    return div;
  }

  function renderAllCards() {
    subjectsGrid.innerHTML = '';
    Object.entries(NOTES).forEach(([key, data]) => {
      subjectsGrid.appendChild(createCard(key, data));
    });
  }

  // Modal open/close & content
  let currentKey = null;
  function openModal(key) {
    currentKey = key;
    modalTitle.textContent = NOTES[key].title;
    modalContent.textContent = NOTES[key].content;
    modal.classList.remove('hidden');
    modal.focus();
  }
  function closeModal() {
    modal.classList.add('hidden');
    currentKey = null;
  }

  modalClose.addEventListener('click', closeModal);
  modalBackdrop.addEventListener('click', closeModal);

  // Download text as .txt file
  function downloadSubject(key) {
    const data = NOTES[key];
    const blob = new Blob([data.title + "\n\n" + data.content], {type: 'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${key}_notes.txt`;
    a.click();
    URL.revokeObjectURL(url);
  }

  modalDownload.addEventListener('click', () => {
    if (currentKey) downloadSubject(currentKey);
  });

  modalPrint.addEventListener('click', () => {
    if (!currentKey) return;
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write(`<pre style="font-family: monospace; white-space: pre-wrap; padding: 1em;">${NOTES[currentKey].title}\n\n${NOTES[currentKey].content}</pre>`);
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
  });

  // Demo PayFast integration (opens payment URL in new tab for demo only)
  const PAYFAST = {
    merchant_id: '10000100', // demo merchant id
    merchant_key: '46f0cd694581a', // demo merchant key
    return_url: window.location.origin + '/payment-success.html',
    cancel_url: window.location.origin + '/payment-cancel.html',
    notify_url: window.location.origin + '/ipn-listener'
  };

  function generatePayFastUrl(item_name, amount) {
    const params = new URLSearchParams({
      merchant_id: PAYFAST.merchant_id,
      merchant_key: PAYFAST.merchant_key,
      return_url: PAYFAST.return_url,
      cancel_url: PAYFAST.cancel_url,
      notify_url: PAYFAST.notify_url,
      amount: amount.toFixed(2),
      item_name
    });
    return 'https://www.payfast.co.za/eng/process?' + params.toString();
  }

  function handleUnlock(key) {
    if (isUnlocked(key)) {
      alert("Already unlocked!");
      return;
    }
    const subject = NOTES[key];
    const payUrl = generatePayFastUrl(subject.title, subject.price);
    // Open PayFast payment page URL in new tab (demo)
    window.open(payUrl, '_blank');
  }

  document.getElementById('unlockAllBtn').addEventListener('click', () => {
    alert('Unlock All feature is disabled in demo.');
  });

  document.getElementById('exportAllBtn').addEventListener('click', () => {
    alert('Download All feature is disabled in demo.');
  });

  document.getElementById('demoLockBtn').addEventListener('click', () => {
    if (confirm("Lock all unlocked subjects?")) {
      lockAll();
      alert("All subjects locked.");
      renderAllCards();
    }
  });

  document.getElementById('demoInfoBtn').addEventListener('click', () => {
    alert("This demo site shows CAIE notes. Clicking Unlock opens a simulated PayFast payment page URL in a new tab.");
  });

  // Keyboard shortcut: Shift + L to lock all
  window.addEventListener('keydown', (e) => {
    if (e.shiftKey && (e.key === 'L' || e.key === 'l')) {
      e.preventDefault();
      if (confirm("Lock all unlocked subjects?")) {
        lockAll();
        alert("All subjects locked.");
        renderAllCards();
      }
    }
  });

  renderAllCards();
  document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
