<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CAIE Notes with Rain & Thunderstorm - Unlock to Read</title>
  <style>
    /* Reset & basics */
    body, html {
      margin: 0; padding: 0; height: 100%;
      background: #0b2434;
      color: #d0dce6;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    #rainCanvas, #thunderCanvas {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
      mix-blend-mode: screen;
    }
    #thunderCanvas {
      z-index: 1;
    }

    header {
      background: rgba(3, 18, 31, 0.85);
      text-align: center;
      padding: 1rem 1.5rem;
      font-weight: 700;
      font-size: 1.5rem;
      color: #60a5fa;
      text-shadow: 0 0 6px #2563eb;
      user-select: none;
      z-index: 5;
      position: relative;
    }
    main {
      display: flex;
      flex: 1;
      height: calc(100vh - 60px);
      backdrop-filter: blur(8px);
      background: rgba(3, 18, 31, 0.6);
      box-shadow: inset 0 0 40px #2563eb80;
      position: relative;
      z-index: 5;
      max-width: 1200px;
      margin: 0 auto;
      border-radius: 8px;
      overflow: hidden;
    }
    nav {
      width: 280px;
      background: rgba(10, 45, 72, 0.8);
      border-radius: 0 0 0 8px;
      padding: 1rem;
      overflow-y: auto;
      box-shadow: 2px 0 15px #0f4fd1aa;
      display: flex;
      flex-direction: column;
    }
    nav h2 {
      margin: 0 0 1rem 0;
      font-size: 1.25rem;
      text-align: center;
      color: #7dd3fc;
      text-shadow: 0 0 8px #0284c7;
    }
    .subject-item {
      background: rgba(32, 64, 98, 0.8);
      padding: 0.7rem 1rem;
      margin-bottom: 0.6rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.3s;
      font-weight: 600;
      color: #a5f3fc;
      box-shadow: 0 0 8px #0c4a6e;
    }
    .subject-item:hover {
      background: #2563ebcc;
      color: #e0f2fe;
      box-shadow: 0 0 14px #60a5fa;
    }
    .locked {
      opacity: 0.4;
      cursor: default;
      box-shadow: none !important;
      color: #6b7280;
    }
    .price-tag {
      font-size: 0.85rem;
      background: #2563ebcc;
      padding: 0.2rem 0.5rem;
      border-radius: 12px;
      user-select: none;
      font-weight: 700;
      color: #dbeafe;
      box-shadow: 0 0 6px #2563ebbb;
    }
    .chapter-list {
      margin-top: 1rem;
      background: rgba(10, 45, 72, 0.8);
      border-radius: 8px;
      padding: 0.5rem 0.8rem;
      overflow-y: auto;
      max-height: 100%;
    }
    .chapter-item {
      padding: 0.5rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      font-weight: 500;
      color: #93c5fd;
      transition: background-color 0.2s;
      margin-bottom: 0.3rem;
      box-shadow: 0 0 6px #0c4a6e;
    }
    .chapter-item:hover {
      background: #3b82f6cc;
      color: #e0f2fe;
      box-shadow: 0 0 14px #60a5fa;
    }
    section.content {
      flex: 1;
      padding: 1.5rem 2rem;
      overflow-y: auto;
      background: rgba(7, 26, 44, 0.9);
      border-radius: 0 8px 8px 0;
      box-shadow: inset 0 0 30px #2563ebaa;
      user-select: text;
    }
    section.content h2 {
      margin-top: 0;
      color: #7dd3fc;
      font-size: 1.75rem;
      text-shadow: 0 0 10px #0284c7;
    }
    section.content h3 {
      color: #60a5fa;
      margin-top: 1.2rem;
      font-weight: 700;
      font-size: 1.3rem;
      text-shadow: 0 0 6px #0c4a6e;
    }
    p, ul, ol, blockquote, pre {
      font-size: 1rem;
      line-height: 1.5;
      margin-top: 0.6rem;
      margin-bottom: 1rem;
      color: #cbd5e1;
      text-shadow: 0 0 3px #1e293b;
    }
    ul, ol {
      padding-left: 1.3rem;
    }
    blockquote {
      border-left: 3px solid #60a5fa;
      padding-left: 1rem;
      font-style: italic;
      color: #a5b4fc;
      background: rgba(9, 28, 50, 0.4);
      margin: 1rem 0;
    }
    pre {
      background: #1e40af;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
      font-family: 'Courier New', Courier, monospace;
      color: #e0e7ff;
      box-shadow: 0 0 6px #2563ebbb;
    }
    button.unlock-btn {
      background: #2563eb;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 0 10px #3b82f6;
      transition: background-color 0.3s;
      user-select: none;
      margin-top: 1rem;
      display: block;
    }
    button.unlock-btn:hover:not(:disabled) {
      background: #1d4ed8;
    }
    button.unlock-btn:disabled {
      background: #94a3b8;
      cursor: not-allowed;
      box-shadow: none;
    }
    footer {
      text-align: center;
      padding: 0.8rem 1rem;
      background: rgba(3, 18, 31, 0.85);
      color: #94a3b8;
      font-size: 0.9rem;
      user-select: none;
      z-index: 5;
      position: relative;
    }
    /* Modal Styles */
    #paymentModal {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 1rem;
    }
    #paymentModal.active {
      display: flex;
    }
    #paymentBox {
      background: #122b42;
      border-radius: 10px;
      padding: 2rem;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 0 30px #2563eb;
      color: #d0dce6;
      font-weight: 600;
    }
    #paymentBox h2 {
      margin-top: 0;
      color: #60a5fa;
      margin-bottom: 1.2rem;
      text-align: center;
      text-shadow: 0 0 10px #0284c7;
    }
    #paymentForm input {
      width: 100%;
      padding: 0.6rem;
      margin-bottom: 1rem;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
      outline: none;
      color: #0b2434;
      font-weight: 600;
    }
    #paymentForm input::placeholder {
      font-weight: 400;
    }
    #paymentButtons {
      display: flex;
      justify-content: space-between;
    }
    #paymentButtons button {
      flex: 1;
      margin: 0 0.25rem;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.7rem;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.3s;
      user-select: none;
    }
    #paymentButtons button:hover {
      background: #1e40af;
    }
    #paymentButtons button:disabled {
      background: #94a3b8;
      cursor: not-allowed;
    }
    .error-message {
      color: #f87171;
      font-weight: 600;
      margin-bottom: 0.8rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <canvas id="rainCanvas"></canvas>
  <canvas id="thunderCanvas"></canvas>

  <header>
    CAIE Notes — Detailed Syllabus | Pay to Unlock
  </header>

  <main>
    <nav>
      <h2>Subjects</h2>
      <div id="subjectsList"></div>
      <button id="unlockAllBtn" class="unlock-btn" style="margin-top: auto;">Unlock All ($6.99 ea.)</button>
    </nav>

    <section class="content" id="contentArea">
      <h2>Welcome to CAIE Notes</h2>
      <p>Select a subject on the left to view chapters. Click Unlock to pay for access. After unlocking, you can read all detailed notes.</p>
      <p>Unlock is a demo — payments are simulated locally with no real transaction.</p>
    </section>
  </main>

  <footer>
    &copy; 2025 CAIE Notes Demo. All rights reserved.
  </footer>

  <!-- Payment Modal -->
  <div id="paymentModal" role="dialog" aria-modal="true" aria-labelledby="paymentTitle">
    <div id="paymentBox">
      <h2 id="paymentTitle">Demo PayFast Payment</h2>
      <form id="paymentForm" novalidate>
        <input type="text" id="payName" placeholder="Full Name" required autocomplete="name" />
        <input type="email" id="payEmail" placeholder="Email Address" required autocomplete="email" />
        <input type="text" id="payCard" placeholder="Card Number (13-19 digits)" required pattern="\d{13,19}" />
        <input type="text" id="payExpiry" placeholder="Expiry (MM/YY)" required pattern="(0[1-9]|1[0-2])\/\d{2}" />
        <input type="text" id="payCVV" placeholder="CVV (3 or 4 digits)" required pattern="\d{3,4}" />
        <div class="error-message" id="paymentError" aria-live="assertive"></div>
        <div id="paymentButtons">
          <button type="button" id="cancelPaymentBtn">Cancel</button>
          <button type="submit" id="submitPaymentBtn">Pay $6.99</button>
        </div>
      </form>
    </div>
  </div>

<script>
  // Data: subjects with chapters & detailed notes (example of detailed notes, add more as needed)
  const NOTES_DATA = {
    mathematics: {
      title: "Mathematics",
      price: 6.99,
      chapters: [
        {
          title: "Chapter 1: Number System & Arithmetic",
          content: `
### Number System & Arithmetic

- **Real Numbers:** Includes integers, rational, irrational numbers, decimals, surds.
- **Simplifying Surds:** Rationalize denominators and simplify by prime factorization.
- **Indices (Exponents):** Rules for multiplication, division, negative & fractional powers.
- **Standard Form:** Express numbers as \(a \times 10^n\), where \(1 \leq a < 10\).

Example:
\`\`\`
Simplify: \(\sqrt{50}\)
= \sqrt{25 \times 2}
= 5\sqrt{2}
\`\`\`
`
        },
        {
          title: "Chapter 2: Algebra",
          content: `
### Algebra

- Simplifying and factorising expressions.
- Solving linear, quadratic, and simultaneous equations.
- Inequalities and functions (domain, range).
- Completing the square and using the quadratic formula.

Example:
Solve \(x^2 - 5x + 6 = 0\)
\[
(x-2)(x-3) = 0 \implies x=2 \text{ or } x=3
\]
`
        },
        // Add more chapters here
      ],
    },
    physics: {
      title: "Physics",
      price: 6.99,
      chapters: [
        {
          title: "Chapter 1: Mechanics",
          content: `
### Mechanics

- **Kinematics:** Displacement, velocity, acceleration. SUVAT equations.
- **Newton’s Laws:** Force, mass, acceleration relation \(F=ma\).
- Free body diagrams and equilibrium.
`
        },
        {
          title: "Chapter 2: Waves & Optics",
          content: `
### Waves & Optics

- Wave properties: amplitude, frequency, wavelength.
- Refraction and Snell's Law: \(n_1 \sin \theta_1 = n_2 \sin \theta_2\).
- Lens formula: \(\frac{1}{f} = \frac{1}{u} + \frac{1}{v}\).
`
        },
      ],
    },
    chemistry: {
      title: "Chemistry",
      price: 6.99,
      chapters: [
        {
          title: "Chapter 1: Atomic Structure",
          content: `
### Atomic Structure

- Structure of atom: protons, neutrons, electrons.
- Isotopes and electron configuration.
- Periodic trends and groups.
`
        },
      ],
    },
    biology: {
      title: "Biology",
      price: 6.99,
      chapters: [
        {
          title: "Chapter 1: Cell Biology",
          content: `
### Cell Biology

- Prokaryotic vs Eukaryotic cells.
- Cell membrane and transport: diffusion, osmosis, active transport.
`
        },
      ],
    },
    islamiyat: {
      title: "Islamiyat",
      price: 6.99,
      chapters: [
        {
          title: "Chapter 1: Introduction to Islam",
          content: `
### Introduction to Islam

- **Definition:** Islam means submission to the will of Allah.
- **Five Pillars:** Shahada, Salah, Zakat, Sawm, Hajj.
- **Hadith Example:** 
  > The Prophet Muhammad (peace be upon him) said: “Actions are judged by intentions.” (Bukhari & Muslim)
`
        },
        {
          title: "Chapter 2: Life of Prophet Muhammad (PBUH)",
          content: `
### Life of Prophet Muhammad (PBUH)

- Birth in Mecca in 570 CE.
- Revelation of the Quran.
- Migration (Hijrah) to Medina.
- Key battles: Badr, Uhud, Khandaq.
- His character and teachings.
`
        },
        // Add all 8 chapters with detailed notes, Quranic verses & hadith as needed
      ],
    }
  };

  // State
  let selectedSubjectKey = null;
  let selectedChapterIndex = null;
  const STORAGE_KEY = 'caieNotesUnlocked';

  // DOM Elements
  const subjectsList = document.getElementById('subjectsList');
  const contentArea = document.getElementById('contentArea');
  const paymentModal = document.getElementById('paymentModal');
  const paymentForm = document.getElementById('paymentForm');
  const payName = document.getElementById('payName');
  const payEmail = document.getElementById('payEmail');
  const payCard = document.getElementById('payCard');
  const payExpiry = document.getElementById('payExpiry');
  const payCVV = document.getElementById('payCVV');
  const paymentError = document.getElementById('paymentError');
  const cancelPaymentBtn = document.getElementById('cancelPaymentBtn');
  const submitPaymentBtn = document.getElementById('submitPaymentBtn');
  const unlockAllBtn = document.getElementById('unlockAllBtn');

  // Unlock data in localStorage
  function getUnlockedSubjects() {
    try {
      const unlocked = localStorage.getItem(STORAGE_KEY);
      return unlocked ? JSON.parse(unlocked) : {};
    } catch {
      return {};
    }
  }
  function setUnlockedSubjects(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  // Render Subjects List
  function renderSubjects() {
    const unlocked = getUnlockedSubjects();
    subjectsList.innerHTML = '';
    for (const key in NOTES_DATA) {
      const sub = NOTES_DATA[key];
      const isUnlocked = !!unlocked[key];
      const item = document.createElement('div');
      item.className = 'subject-item' + (isUnlocked ? '' : ' locked');
      item.textContent = sub.title;
      if (!isUnlocked) {
        const priceTag = document.createElement('span');
        priceTag.className = 'price-tag';
        priceTag.textContent = `$${sub.price.toFixed(2)}`;
        item.appendChild(priceTag);
      }
      item.addEventListener('click', () => {
        if (isUnlocked) {
          selectSubject(key);
        } else {
          openPaymentModal(key);
        }
      });
      subjectsList.appendChild(item);
    }
  }

  // Render chapters for selected subject
  function renderChapters(subjectKey) {
    contentArea.innerHTML = '';
    const unlocked = getUnlockedSubjects();
    const subject = NOTES_DATA[subjectKey];
    const isUnlocked = !!unlocked[subjectKey];
    if (!subject) {
      contentArea.innerHTML = `<p>Subject not found.</p>`;
      return;
    }

    const header = document.createElement('h2');
    header.textContent = subject.title;
    contentArea.appendChild(header);

    if (!isUnlocked) {
      const unlockBtn = document.createElement('button');
      unlockBtn.className = 'unlock-btn';
      unlockBtn.textContent = `Unlock this subject for $${subject.price.toFixed(2)}`;
      unlockBtn.addEventListener('click', () => openPaymentModal(subjectKey));
      contentArea.appendChild(unlockBtn);
      return;
    }

    if (subject.chapters.length === 0) {
      contentArea.innerHTML += '<p>No chapters available.</p>';
      return;
    }

    const list = document.createElement('div');
    list.className = 'chapter-list';
    subject.chapters.forEach((ch, i) => {
      const chItem = document.createElement('div');
      chItem.className = 'chapter-item';
      chItem.textContent = ch.title;
      chItem.addEventListener('click', () => {
        renderChapterContent(subjectKey, i);
      });
      list.appendChild(chItem);
    });
    contentArea.appendChild(list);
  }

  // Render detailed notes for chapter
  function renderChapterContent(subjectKey, chapterIndex) {
    const unlocked = getUnlockedSubjects();
    const subject = NOTES_DATA[subjectKey];
    if (!subject) return;

    if (!unlocked[subjectKey]) {
      contentArea.innerHTML = '<p>Please unlock this subject first.</p>';
      return;
    }

    const chapter = subject.chapters[chapterIndex];
    if (!chapter) {
      contentArea.innerHTML = '<p>Chapter not found.</p>';
      return;
    }
    contentArea.innerHTML = '';

    const titleH2 = document.createElement('h2');
    titleH2.textContent = subject.title;
    contentArea.appendChild(titleH2);

    const chapterH3 = document.createElement('h3');
    chapterH3.textContent = chapter.title;
    contentArea.appendChild(chapterH3);

    // Parse markdown-like content (basic)
    const lines = chapter.content.trim().split('\n');
    lines.forEach(line => {
      line = line.trim();
      if (line.startsWith('### ')) {
        const h4 = document.createElement('h4');
        h4.textContent = line.replace('### ', '');
        h4.style.color = '#7dd3fc';
        h4.style.marginTop = '1rem';
        contentArea.appendChild(h4);
      } else if (line.startsWith('- ')) {
        // List items
        let ul = contentArea.querySelector('ul:last-child');
        if (!ul) {
          ul = document.createElement('ul');
          contentArea.appendChild(ul);
        }
        const li = document.createElement('li');
        li.textContent = line.replace('- ', '');
        ul.appendChild(li);
      } else if (line.startsWith('> ')) {
        // Blockquote
        const block = document.createElement('blockquote');
        block.textContent = line.replace('> ', '');
        contentArea.appendChild(block);
      } else if (line.startsWith('```')) {
        // code block start/end
        // For simplicity, skip in this demo
      } else if (line.match(/^\$.*\$|\\\[.*\\\]|\\\(.*\\\)/)) {
        // Math line, skip rendering math in this demo
        const p = document.createElement('p');
        p.textContent = line;
        contentArea.appendChild(p);
      } else if(line.length === 0){
        // skip blank
      } else {
        const p = document.createElement('p');
        p.textContent = line;
        contentArea.appendChild(p);
      }
    });
  }

  // Select subject handler
  function selectSubject(key) {
    selectedSubjectKey = key;
    selectedChapterIndex = null;
    renderChapters(key);
  }

  // Payment modal state
  let payingForSubject = null;

  function openPaymentModal(subjectKey) {
    payingForSubject = subjectKey;
    paymentForm.reset();
    paymentError.textContent = '';
    submitPaymentBtn.disabled = false;
    paymentModal.classList.add('active');
    payName.focus();
  }

  function closePaymentModal() {
    paymentModal.classList.remove('active');
    payingForSubject = null;
  }

  // Validate card number (basic)
  function validateCardNumber(num) {
    return /^\d{13,19}$/.test(num);
  }
  function validateExpiry(exp) {
    return /^(0[1-9]|1[0-2])\/\d{2}$/.test(exp);
  }
  function validateCVV(cvv) {
    return /^\d{3,4}$/.test(cvv);
  }

  paymentForm.addEventListener('submit', e => {
    e.preventDefault();
    paymentError.textContent = '';
    submitPaymentBtn.disabled = true;

    if (!payName.value.trim() || !payEmail.value.trim() || !payCard.value.trim() || !payExpiry.value.trim() || !payCVV.value.trim()) {
      paymentError.textContent = 'Please fill all fields.';
      submitPaymentBtn.disabled = false;
      return;
    }
    if (!validateCardNumber(payCard.value.trim())) {
      paymentError.textContent = 'Card number must be 13 to 19 digits.';
      submitPaymentBtn.disabled = false;
      return;
    }
    if (!validateExpiry(payExpiry.value.trim())) {
      paymentError.textContent = 'Expiry must be MM/YY format.';
      submitPaymentBtn.disabled = false;
      return;
    }
    if (!validateCVV(payCVV.value.trim())) {
      paymentError.textContent = 'CVV must be 3 or 4 digits.';
      submitPaymentBtn.disabled = false;
      return;
    }

    // Simulate payment delay
    submitPaymentBtn.textContent = 'Processing...';
    setTimeout(() => {
      // Mark subject as unlocked
      const unlocked = getUnlockedSubjects();
      if (payingForSubject === 'all') {
        // unlock all
        for (const key in NOTES_DATA) {
          unlocked[key] = true;
        }
      } else if (payingForSubject) {
        unlocked[payingForSubject] = true;
      }
      setUnlockedSubjects(unlocked);

      closePaymentModal();
      renderSubjects();
      if (payingForSubject !== 'all') {
        selectSubject(payingForSubject);
      } else {
        contentArea.innerHTML = '<h2>All Subjects Unlocked!</h2><p>You can now browse all detailed notes.</p>';
      }
      payingForSubject = null;
      submitPaymentBtn.textContent = 'Pay $6.99';
    }, 1500);
  });

  cancelPaymentBtn.addEventListener('click', () => {
    closePaymentModal();
  });

  // Unlock all button
  unlockAllBtn.addEventListener('click', () => {
    openPaymentModal('all');
  });

  // Initial render
  renderSubjects();

  // ----------- Rain + Thunderstorm animation --------------

  const rainCanvas = document.getElementById('rainCanvas');
  const thunderCanvas = document.getElementById('thunderCanvas');
  const rainCtx = rainCanvas.getContext('2d');
  const thunderCtx = thunderCanvas.getContext('2d');

  let W, H;
  function resize() {
    W = window.innerWidth;
    H = window.innerHeight;
    rainCanvas.width = W;
    rainCanvas.height = H;
    thunderCanvas.width = W;
    thunderCanvas.height = H;
  }
  window.addEventListener('resize', resize);
  resize();

  // Raindrop class
  class Raindrop {
    constructor() {
      this.reset();
    }
    reset() {
      this.x = Math.random() * W;
      this.y = Math.random() * -H;
      this.length = 10 + Math.random() * 20;
      this.speed = 4 + Math.random() * 4;
      this.opacity = 0.2 + Math.random() * 0.3;
      this.width = 1 + Math.random() * 1;
    }
    update() {
      this.y += this.speed;
      if (this.y > H) this.reset();
    }
    draw(ctx) {
      ctx.beginPath();
      ctx.strokeStyle = `rgba(174,194,224,${this.opacity})`;
      ctx.lineWidth = this.width;
      ctx.moveTo(this.x, this.y);
      ctx.lineTo(this.x, this.y + this.length);
      ctx.stroke();
    }
  }

  const raindrops = [];
  for (let i = 0; i < 600; i++) {
    raindrops.push(new Raindrop());
  }

  // Thunder variables
  let thunderOpacity = 0;
  let thunderDuration = 0;
  let thunderX = 0;
  let thunderY = 0;
  let thunderActive = false;

  function drawThunder() {
    if (!thunderActive) {
      if (Math.random() < 0.005) { // 0.5% chance per frame to start thunder
        thunderActive = true;
        thunderDuration = 15 + Math.floor(Math.random() * 10);
        thunderX = Math.random() * W * 0.8 + W * 0.1;
        thunderY = Math.random() * H * 0.4 + H * 0.05;
        thunderOpacity = 1;
      }
    } else {
      thunderCtx.clearRect(0, 0, W, H);
      thunderCtx.fillStyle = `rgba(255,255,255,${thunderOpacity})`;
      thunderCtx.beginPath();

      // Draw a jagged lightning bolt shape
      let startX = thunderX;
      let startY = thunderY;
      thunderCtx.moveTo(startX, startY);
      for (let i = 0; i < 10; i++) {
        startX += (Math.random() * 20 - 10);
        startY += 10 + Math.random() * 20;
        thunderCtx.lineTo(startX, startY);
      }
      thunderCtx.lineWidth = 2 + Math.random() * 2;
      thunderCtx.shadowColor = 'white';
      thunderCtx.shadowBlur = 10;
      thunderCtx.strokeStyle = `rgba(255, 255, 255, ${thunderOpacity})`;
      thunderCtx.stroke();

      thunderDuration--;
      thunderOpacity -= 0.07;
      if (thunderDuration <= 0 || thunderOpacity <= 0) {
        thunderActive = false;
        thunderCtx.clearRect(0, 0, W, H);
      }
    }
  }

  function animate() {
    rainCtx.clearRect(0, 0, W, H);
    for (let drop of raindrops) {
      drop.update();
      drop.draw(rainCtx);
    }
    drawThunder();
    requestAnimationFrame(animate);
  }
  animate();

</script>
</body>
</html>
